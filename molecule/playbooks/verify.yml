---
- name: Verify
  hosts: all

  vars:
    pass_install_method: "{{ lookup('env', 'pass_install_method') | default('distro_package', True) }}"
    pass_state: "{{ lookup('env', 'pass_state') | default('present', True) }}"

  tasks:
    - name: Check if Pass is present
      register: pass_presence
      changed_when: false
      failed_when: false
      ansible.builtin.command:
        cmd: which pass

    - name: Ensure Pass is installed
      when: pass_state == "present"
      ansible.builtin.assert:
        quiet: true
        that: pass_presence.rc == 0


    - name: Ensure Pass is uninstalled
      when: pass_state == "absent"
      ansible.builtin.assert:
        quiet: true
        that: pass_presence.rc != 0
